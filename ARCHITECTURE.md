# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

LLM-as-a-Judge è©•ä¾¡ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®æ§‹æˆã¨æŠ€è¡“è©³ç´°ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
sample-llm-jadge/
â”œâ”€â”€ src/                    # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ cli.ts              # CLIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ index.ts            # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ commands/           # CLIã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ validate.ts     # validateã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ run.ts          # runã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â””â”€â”€ aggregate.ts    # aggregateã‚³ãƒãƒ³ãƒ‰
â”‚   â”œâ”€â”€ providers/          # Judgeãƒ—ãƒ­ãƒã‚¤ãƒ€
â”‚   â”‚   â”œâ”€â”€ base_judge.ts   # æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ openai_judge.ts # OpenAIå®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ gemini_judge.ts # Geminiå®Ÿè£…
â”‚   â”‚   â””â”€â”€ factory.ts      # ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ•ã‚¡ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ evaluation/         # è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ scorer.ts       # ã‚¹ã‚³ã‚¢è¨ˆç®—
â”‚   â”‚   â”œâ”€â”€ runner.ts       # è©•ä¾¡å®Ÿè¡Œ
â”‚   â”‚   â””â”€â”€ aggregator.ts   # çµæœé›†ç´„
â”‚   â”œâ”€â”€ rubric/             # è©•ä¾¡è¦³ç‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ criteria_loader.ts  # è©•ä¾¡è¦³ç‚¹èª­ã¿è¾¼ã¿
â”‚   â”‚   â”œâ”€â”€ weights_loader.ts   # é‡ã¿è¨­å®šèª­ã¿è¾¼ã¿
â”‚   â”‚   â””â”€â”€ prompt_builder.ts   # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
â”‚   â”œâ”€â”€ schemas/            # JSON Schemaãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â””â”€â”€ validator.ts    # Ajvã«ã‚ˆã‚‹æ¤œè¨¼
â”‚   â”œâ”€â”€ types/              # TypeScriptå‹å®šç¾©
â”‚   â””â”€â”€ utils/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ env.ts          # ç’°å¢ƒå¤‰æ•°ç®¡ç†
â”‚       â””â”€â”€ logger.ts       # ãƒ­ã‚¬ãƒ¼
â”œâ”€â”€ rubric/                 # è©•ä¾¡è¦³ç‚¹å®šç¾©ï¼ˆJSONï¼‰
â”‚   â”œâ”€â”€ criteria_v1.json    # 11è©•ä¾¡è¦³ç‚¹å®šç¾©
â”‚   â”œâ”€â”€ weights_presets_v1.json  # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹åˆ¥é‡ã¿
â”‚   â””â”€â”€ prompts/            # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ schemas/                # JSON Schemaãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ judge_request_v1.schema.json  # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚­ãƒ¼ãƒ
â”‚   â””â”€â”€ judge_result_v1.schema.json   # çµæœã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ samples/                # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ uc1_*.json          # UC1: ä¼šè©±è¦ç´„
â”‚   â”œâ”€â”€ uc2_*.json          # UC2: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”‚   â””â”€â”€ uc3_*.json          # UC3: ãƒ¬ãƒãƒ¼ãƒˆQA
â””â”€â”€ tests/                  # ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ unit/               # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ integration/        # çµ±åˆãƒ†ã‚¹ãƒˆ
    â””â”€â”€ e2e/                # E2Eãƒ†ã‚¹ãƒˆ
```

---

## ğŸ›  CLIã‚³ãƒãƒ³ãƒ‰

### validate - JSONãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```bash
npx tsx src/cli.ts validate --json <ãƒ•ã‚¡ã‚¤ãƒ«> --schema <request|result>
```

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|------|
| `--json` | æ¤œè¨¼ã™ã‚‹JSONãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆå¿…é ˆï¼‰ |
| `--schema` | ã‚¹ã‚­ãƒ¼ãƒã‚¿ã‚¤ãƒ—: `request` ã¾ãŸã¯ `result`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: resultï¼‰ |

**ä¾‹:**
```bash
npx tsx src/cli.ts validate --json samples/uc1_request.json --schema request
```

---

### run - è©•ä¾¡å®Ÿè¡Œ

```bash
npx tsx src/cli.ts run --json <ãƒ•ã‚¡ã‚¤ãƒ«> --provider <openai|gemini> [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]
```

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|------|
| `--json` | è©•ä¾¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆJSONãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¿…é ˆï¼‰ |
| `--provider` | Judgeãƒ—ãƒ­ãƒã‚¤ãƒ€: `openai` ã¾ãŸã¯ `gemini`ï¼ˆå¿…é ˆï¼‰ |
| `--model` | ãƒ¢ãƒ‡ãƒ«åã®ä¸Šæ›¸ãï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| `--output` | çµæœå‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |

**ä¾‹:**
```bash
npx tsx src/cli.ts run --json samples/uc1_request.json --provider openai --output result.json
```

---

### aggregate - çµæœé›†ç´„

```bash
npx tsx src/cli.ts aggregate <ãƒ•ã‚¡ã‚¤ãƒ«...> [--output <ãƒ•ã‚¡ã‚¤ãƒ«>]
```

è¤‡æ•°ã®è©•ä¾¡çµæœã‚’é›†ç´„ã—ã¦çµ±è¨ˆæƒ…å ±ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

**ä¾‹:**
```bash
npx tsx src/cli.ts aggregate samples/uc1_result.json samples/uc2_result.json
```

---

## ğŸ“Š è©•ä¾¡è¦³ç‚¹ï¼ˆ11è¦³ç‚¹ï¼‰

### ã‚³ã‚¢è¦³ç‚¹ï¼ˆ9ã¤ï¼‰

| è¦³ç‚¹ | èª¬æ˜ |
|------|------|
| `accuracy` | ã‚½ãƒ¼ã‚¹è³‡æ–™ã«å¯¾ã™ã‚‹äº‹å®Ÿã®æ­£ç¢ºæ€§ |
| `completeness` | ä¸»è¦ãƒã‚¤ãƒ³ãƒˆã®ã‚«ãƒãƒ¼ç‡ |
| `relevance` | æŒ‡ç¤ºã¸ã®é©åˆåº¦ |
| `coherence` | è«–ç†çš„æ§‹æˆã¨ä¸€è²«æ€§ |
| `conciseness` | ç°¡æ½”ã•ã€æƒ…å ±å¯†åº¦ |
| `clarity` | è¡¨ç¾ã®æ˜ç¢ºã• |
| `reasoning` | è«–ç†çš„æ¨è«–ã®è³ª |
| `harmlessness` | æœ‰å®³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸åœ¨ |
| `format_compliance` | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¦ä»¶ã¸ã®æº–æ‹  |

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¦³ç‚¹ï¼ˆ2ã¤ï¼‰

| è¦³ç‚¹ | èª¬æ˜ |
|------|------|
| `citation_quality` | å¼•ç”¨ã®å“è³ªã¨æ­£ç¢ºæ€§ |
| `actionability` | å®Ÿè¡Œå¯èƒ½ãªææ¡ˆã®æœ‰ç„¡ |

---

## ğŸ¯ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

### ã‚¹ã‚³ã‚¢ã‚¢ãƒ³ã‚«ãƒ¼ï¼ˆ1/3/5ï¼‰

å„è¦³ç‚¹ã§3æ®µéšã®ã‚¢ãƒ³ã‚«ãƒ¼ã‚’å®šç¾©ï¼š
- **Score 1**: æœ€ä½å“è³ªã®åŸºæº–
- **Score 3**: ä¸­ç¨‹åº¦ã®å“è³ª
- **Score 5**: æœ€é«˜å“è³ªã®åŸºæº–

### åŠ é‡å¹³å‡è¨ˆç®—

```typescript
weighted_score = Î£(score Ã— weight) / Î£(weight)
```

ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã”ã¨ã«ç•°ãªã‚‹é‡ã¿ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é©ç”¨ã€‚

### ç°¡æ½”ã•ãƒšãƒŠãƒ«ãƒ†ã‚£

| æ¡ä»¶ | ãƒšãƒŠãƒ«ãƒ†ã‚£ |
|------|-----------|
| `conciseness â‰¤ 2` | `-0.3`ï¼ˆä¸‹é™: 1.0ï¼‰ |

### åˆå¦åˆ¤å®š

```
pass = format_valid AND weighted_score â‰¥ 3.0 AND format_compliance â‰¥ 3
```

---

## ğŸ”Œ ãƒ—ãƒ­ãƒã‚¤ãƒ€å®Ÿè£…

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
BaseJudge (æŠ½è±¡ã‚¯ãƒ©ã‚¹)
â”œâ”€â”€ OpenAIJudge (GPT-4o)
â””â”€â”€ GeminiJudge (Gemini)
```

### ç’°å¢ƒå¤‰æ•°

```bash
# .env
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=...
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `npm run test` | å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| `npm run test:unit` | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿ |
| `npm run test:integration` | çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿ |
| `npm run test:e2e` | E2Eãƒ†ã‚¹ãƒˆã®ã¿ |
| `npm run typecheck` | å‹ãƒã‚§ãƒƒã‚¯ |
| `npm run build` | TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ« |

---

## ğŸ“ JSON Schema

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚­ãƒ¼ãƒï¼ˆjudge_request_v1ï¼‰

```json
{
  "request_id": "string",
  "task_type": "summarization | report_generation | report_qa",
  "input": {
    "source_text": "string",
    "instruction": "string",
    "reference_output": "string (optional)"
  },
  "output": {
    "model_name": "string",
    "generated_text": "string"
  },
  "metadata": {}
}
```

### çµæœã‚¹ã‚­ãƒ¼ãƒï¼ˆjudge_result_v1ï¼‰

è©•ä¾¡çµæœã¨ã—ã¦å„è¦³ç‚¹ã®ã‚¹ã‚³ã‚¢ãƒ»ç†ç”±ãƒ»åŠ é‡å¹³å‡ãƒ»åˆå¦ã‚’å‡ºåŠ›ã€‚

---

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|---------|------|
| è¨€èª | TypeScript 5.7 |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | Node.js 18+ |
| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ESM (`"type": "module"`) |
| CLI | Commander.js |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | Ajv (JSON Schema) |
| ãƒ†ã‚¹ãƒˆ | Vitest |
| LLM SDK | openai, @google/generative-ai |

---

## ğŸ›¡ åé•·æ–‡ãƒã‚¤ã‚¢ã‚¹å¯¾ç­–ï¼ˆ3å±¤é˜²å¾¡ï¼‰

1. **ãƒ«ãƒ¼ãƒ–ãƒªãƒƒã‚¯ã‚¢ãƒ³ã‚«ãƒ¼**: `conciseness`è¦³ç‚¹ã§æ˜ç¢ºãªã‚¹ã‚³ã‚¢åŸºæº–
2. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæŒ‡ç¤º**: Judgeå‘ã‘ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ç°¡æ½”ã•é‡è¦–ã®æŒ‡ç¤º
3. **æ©Ÿæ¢°çš„ãƒšãƒŠãƒ«ãƒ†ã‚£**: ä½ã‚¹ã‚³ã‚¢æ™‚ã®è‡ªå‹•æ¸›ç‚¹
